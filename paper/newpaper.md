
------

# 项目名称：基于 LLM 动态图谱与 Quantum-RWKV 时空解耦的金融风险评估研究

## 摘要 (Abstract)

金融市场的信用风险预测面临数据高噪声、非线性混沌动态及市场环境非平稳性（Non-stationarity）的三重挑战。传统深度模型难以有效分离宏观市场趋势与个股微观波动，且在捕捉长序列混沌特征时存在瓶颈。本项目提出 **QL-MATCC-GNN** 框架：

1. **动态语义图谱 (LLM-Graph)**：针对海量财经新闻，提出一种高效的**基于标题 (Headline-based)** 的零样本关系抽取方法，利用大语言模型 (LLM) 构建反映供应链与竞争关系的动态邻接矩阵。
2. **多尺度趋势解耦 (MATCC)**：引入市场趋势引导机制 (Market Guidance)，利用 1D-CNN 提取宏观指数特征作为全局条件，并将个股时序显式分解为长期趋势项与短期波动项，有效缓解分布偏移问题。
3. **量子增强时序编码 (Quantum-RWKV)**：在 RWKV 的线性注意力机制中嵌入 **变分量子线路 (VQC)**，利用量子纠缠特性捕捉经典神经网络难以拟合的高维混沌特征。
4. **混合推理与时空融合**：设计基于波动率的**混合采样策略 (Hybrid Sampling)**，仅对高风险样本启用量子通道以平衡算力；最终通过 **图注意力网络 (GAT)** 聚合时序特征与空间邻居信息，实现时空维度的深度融合。

------

## 1. 研究背景与痛点分析 (Introduction)

- **痛点一：宏观与微观的纠缠**。个股价格往往受大盘（Beta）和自身经营（Alpha）共同影响。传统 LSTM/Transformer 难以剥离系统性风险，导致模型在牛熊市转换时泛化能力差。
- **痛点二：长序列中的混沌信号**。金融危机前的信号往往隐藏在长周期的微小扰动中。哈佛大学等研究表明，经典神经网络在处理此类“混沌动力学”时存在捕捉瓶颈。
- **痛点三：非结构化信息的缺失**。仅靠量价数据无法捕捉企业间的传导风险（如供应商暴雷导致股价下跌）。

------

## 2. 核心方法论 (Methodology)

### 2.1 模块一：基于 LLM 的轻量化动态图谱构建

- **数据源优化**：考虑到全量新闻处理的算力成本与噪音问题，本项目创新性地采用 **“仅标题 (Headline-only)”** 策略。
- **零样本关系抽取**：
  - **输入**：清洗后的每日财经新闻标题（来源于 FNSPID 数据集）。
  - **处理**：利用 Prompt Engineering 驱动 LLM（服务器上下载好了Qwen2.5-14B-Instruct 模型）识别显式实体关系（如 `(A公司, 供应, B公司)`、`(C公司, 起诉, D公司)`）。
  - **输出**：构建加权邻接矩阵 $\mathcal{A}$，其中 $\mathcal{A}_{ij}=1$ 表示两家公司在近期新闻中存在强关联。这一步骤将非结构化文本转化为结构化的图谱先验。
  
- **动态图到“全局演化图谱”的聚合**：在工程实现中，首先基于**按时间顺序不断到来的新闻流**抽取关系边，随后将训练集时间段内（例如 2019–2022 年）的所有关系**在时间维度上进行聚合**，形成一个**全局加权邻接矩阵**并在整个训练过程中保持固定。这样既保持了“由动态新闻驱动”的演化特性，又能大幅降低动态图每步更新带来的计算和显存开销，更专注于刻画长期稳定的供应链/竞争关系。
  
> 备注：为了严格避免“未来信息”泄露，在构建图谱时仅使用与训练集对应时间段之前的新闻样本来计算邻接矩阵，测试集时间段（如 2023 年）的新闻**不会参与建图**。

### 2.2 模块二：基于 MATCC 的趋势解耦 (Trend Decomposition)

- **宏观引导 (Market Guidance)**：

  - 输入：S&P 500 指数及波动率序列 $M_t$。
  - 操作：使用 **2层 1D-CNN** 提取宏观特征 $h_{market}$，并通过 LayerNorm 后广播拼接到所有个股的时序特征中，作为全局上下文条件。

- **序列分解**：

  - 利用因果滑动平均 (Causal Moving Average) 将个股序列 $X_u$ 分解为：

    

    $$X_u = X_u^{trend} + X_u^{fluctuation}$$

  - $X^{trend}$ 反映基本面长期趋势，$X^{fluctuation}$ 反映短期市场情绪波动，分别通过独立的线性层进行编码。

### 2.3 模块三：Quantum-RWKV 时序编码器 (核心创新)

- **骨干网络**：采用 **RWKV** (Receptance Weighted Key Value) 架构，保持 Transformer 级别的性能同时具备 RNN 的线性计算复杂度。
- **量子通道混合 (Quantum Channel Mixing)**：
  - 在 RWKV 的 `Channel Mixing` 阶段引入双路并行结构。
  - **量子通路**：设计 **4-Qubit 变分量子线路 (VQC)**。使用 `AngleEmbedding` 将特征映射到希尔伯特空间，通过 `StronglyEntanglingLayers` 进行纠缠演化，最后测量 Pauli-Z 期望值作为输出。
- **混合采样策略 (Hybrid Sampling Strategy)**：
  - *机制*：预计算个股的滚动波动率 (Volatility)。
  - *判别*：当 `Volatility > Threshold` 时，激活量子通路处理高风险混沌信号；否则仅使用经典 FFN 通路。此举在保留量子优势的同时，大幅降低了训练与推理的延迟。

### 2.4 模块四：时空特征融合 (Spatiotemporal Fusion)

- **时序特征提取**：Quantum-RWKV 输出每个节点（个股）的时间序列表征 $H_{temporal}$。
- **空间特征聚合 (GAT Aggregation)**：
  - 引入 **图注意力层 (Graph Attention Layer)**。利用模块一构建的邻接矩阵 $\mathcal{A}$，计算节点 $i$ 与其邻居节点 $j$ 之间的注意力系数 $\alpha_{ij}$。
  - 聚合邻居特征得到空间表征 $H_{graph}$。
- **晚期融合 (Late Fusion)**：
  - 将 $H_{temporal}$ 与 $H_{graph}$ 进行拼接 (Concatenation)，通过全连接层输出最终的收益率预测或风险评分。

------

## 3. 实验设计与结果分析 (Experiments)

### 3.1 数据集与预处理

- **数据来源**：FNSPID (Financial News and Stock Price Integration Dataset)。
- **时间跨度**：2019-01-01 至 2023-12-31。
- **预处理**：完成了数千只个股的对齐、S&P 500 指数引入、以及新闻标题的清洗与聚合。
  
- **时间划分与防止数据泄露**：在时间维度上按照日期进行 8:2 划分，前 80% 的交易日作为训练集，其余作为测试集。图谱构建阶段仅使用训练集时间段之前的新闻样本来构建“全局演化邻接矩阵”，从而避免利用测试期（未来）的新闻信息反向影响训练期的图结构，确保实验设置不存在 Data Leakage。

### 3.2 消融实验 (Ablation Studies)

为了验证各模块的有效性，设计了如下变体：

1. **Full Model (QL-MATCC-GNN)**：完整模型。
2. **w/o Quantum**：移除 VQC，仅使用经典 MLP。验证量子层在捕捉高波动特征时的优势。
3. **w/o MATCC**：移除趋势解耦模块。验证解耦机制对非平稳数据的适应性。
4. **w/o Market Guidance**：移除大盘指数输入。验证宏观信息对个股预测的辅助作用。
5. **w/o Graph**：移除 GAT 层（即邻接矩阵设为单位阵）。验证 LLM 构建的关系图谱是否提供了额外增益。

> 训练策略说明：由于 GNN 在 batch 内进行邻居聚合，单个 batch 中难以完全保证所有样本严格对齐在同一时刻。本文在工程上采用较大的 batch size（例如 512），使得每个 batch 中来自相近时间窗口和相关股票的样本占比较高，从而在可接受的时间错位噪声下近似实现时空一致性的图聚合，这属于时空图神经网络中常见的 Sampled Batch 训练折中方案。

### 3.3 评价指标

- **MSE (均方误差)**：衡量回归预测的准确性。
- **分段性能分析**：重点观察模型在**高波动率区间 (High Volatility Regimes)** 的表现，以验证量子模块的抗噪能力。

------

## 4. 工程实现细节 (Implementation)

- **深度学习框架**：PyTorch + PennyLane (量子模拟)。
- **加速技术**：
  - **JIT 编译**：使用 `torch.jit.script` 优化 RWKV 核心算子，实现 CPU/GPU 上的串行计算加速。
  - **混合精度训练**：在经典模块使用 AMP (Automatic Mixed Precision) 减少显存占用（注：量子模块需保持 FP32 以确保数值稳定性）。
  - **流式数据处理**：针对 23GB 新闻数据，采用 Chunk 分块读取与清洗策略，有效控制内存峰值。

------

### **此版本的改进点说明（供你参考）：**

1. **实事求是**：将原本提到的 "EvolveGCN" 修改为更符合你代码实现的 **GAT (Graph Attention Network)** 聚合层。
2. **强调工程亮点**：在方法论中明确了“Headline-only”策略，这在答辩时是一个很好的点，说明你考虑了计算成本和工程落地。
3. **逻辑闭环**：现在的四个模块（图谱构建 -> 趋势解耦 -> 量子时序 -> 时空融合）和你手头的代码文件一一对应，不再有“论文写了但代码没写”的尴尬。