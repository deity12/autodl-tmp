# 评估指标说明文档

## 📊 保存的评估指标

运行训练或消融实验后，系统会自动计算并保存以下评估指标：

### 1. **MSE (Mean Squared Error)** - 均方误差
- **定义**：预测值与真实值差的平方的平均值
- **公式**：$MSE = \frac{1}{n}\sum_{i=1}^{n}(y_i - \hat{y}_i)^2$
- **特点**：对异常值敏感，数值越大表示误差越大
- **论文用途**：主要训练指标，用于模型选择和早停

### 2. **MAE (Mean Absolute Error)** - 平均绝对误差
- **定义**：预测值与真实值差的绝对值的平均值
- **公式**：$MAE = \frac{1}{n}\sum_{i=1}^{n}|y_i - \hat{y}_i|$
- **特点**：对异常值不敏感，更直观地反映平均误差
- **论文用途**：补充 MSE，提供更易理解的误差度量

### 3. **RMSE (Root Mean Squared Error)** - 均方根误差
- **定义**：MSE 的平方根
- **公式**：$RMSE = \sqrt{MSE}$
- **特点**：与目标变量同单位，便于解释
- **论文用途**：常用于金融预测论文，与 MAE 一起展示

### 4. **R² (R-squared / Coefficient of Determination)** - 决定系数
- **定义**：模型解释的方差占总方差的比例
- **公式**：$R^2 = 1 - \frac{SS_{res}}{SS_{tot}}$
- **取值范围**：$(-\infty, 1]$，越接近 1 越好
- **论文用途**：**重要指标**，衡量模型拟合优度，金融论文常用

### 5. **Correlation Coefficient** - 相关系数
- **定义**：预测值与真实值的线性相关程度
- **公式**：$r = \frac{\text{Cov}(y, \hat{y})}{\sigma_y \sigma_{\hat{y}}}$
- **取值范围**：$[-1, 1]$，绝对值越大相关性越强
- **论文用途**：衡量预测方向的一致性，对金融预测很重要

### 6. **Directional Accuracy** - 方向准确率 ⭐
- **定义**：预测涨跌方向的准确率（预测值与真实值符号相同的比例）
- **公式**：$\text{DA} = \frac{1}{n}\sum_{i=1}^{n}\mathbf{1}[\text{sign}(y_i) = \text{sign}(\hat{y}_i)]$
- **取值范围**：$[0, 1]$，0.5 表示随机猜测，1.0 表示完全正确
- **论文用途**：**金融预测的核心指标**，衡量模型是否能正确预测涨跌方向

### 7. **MAPE (Mean Absolute Percentage Error)** - 平均绝对百分比误差
- **定义**：预测误差相对于真实值的百分比
- **公式**：$MAPE = \frac{100}{n}\sum_{i=1}^{n}\left|\frac{y_i - \hat{y}_i}{y_i}\right|$
- **特点**：相对误差，便于跨数据集比较
- **论文用途**：补充指标，但金融数据中真实值可能接近 0，需谨慎使用

### 8. **IC (Information Coefficient)** - 信息系数 ⭐⭐⭐
- **定义**：预测值与真实值之间的 **Pearson 相关系数**
- **公式**：$IC = \text{Corr}(\hat{y}, y)$
- **取值范围**：$[-1, 1]$，绝对值越大越好
- **特点**：量化金融领域的**黄金标准指标**，衡量模型预测的线性相关性
- **论文用途**：**核心指标**，直接回答"模型打分越高，股票是否真的涨得越好"
- **参考值**：IC > 0.05 已经不错，IC > 0.1 是非常好的结果

### 9. **RankIC (Rank Information Coefficient)** - 秩信息系数 ⭐⭐⭐
- **定义**：预测值排名与真实值排名之间的 **Spearman 秩相关系数**
- **公式**：$RankIC = \text{Spearman}(\text{rank}(\hat{y}), \text{rank}(y))$
- **取值范围**：$[-1, 1]$，绝对值越大越好
- **特点**：
  - 比 IC 更稳健，不受个别暴涨暴跌股票的影响
  - **基金公司最看重的指标**，用于选股策略
  - 衡量模型的**排序能力**（能否正确识别哪些股票会涨得更多）
- **论文用途**：**核心指标**，证明模型在量化投资中的实用性
- **参考值**：RankIC > 0.05 已经不错，RankIC > 0.1 是非常好的结果

## 📁 保存位置

### Full Model 训练 (`train_gnn.py`)
- **文件**：`paper/model/training_losses_gnn.json`
- **包含**：Loss 历史 + 所有评估指标（在最佳模型上计算）

### 消融实验 (`run_ablation.py`)
- **文件**：`paper/model/ablation/losses_{exp_name}.json`
- **包含**：每个实验的 Loss 历史 + 所有评估指标
- **汇总**：`paper/model/ablation/ablation_results_summary.csv`（包含所有指标）

## 📈 论文使用建议

### 核心指标（必须展示）⭐⭐⭐
1. **MSE**：训练过程的主要指标
2. **R²**：模型拟合优度
3. **Directional Accuracy**：金融预测的核心指标（涨跌方向准确率）
4. **IC (Information Coefficient)**：量化金融黄金标准，衡量预测线性相关性
5. **RankIC (Rank Information Coefficient)**：基金公司最看重，衡量排序能力

### 补充指标（建议展示）
6. **MAE / RMSE**：提供更直观的误差度量
7. **Correlation**：展示预测与真实值的相关性（与 IC 类似，但 IC 更专业）

### 可选指标
8. **MAPE**：如果数据适合（真实值不接近 0）

## 📝 论文表格示例

在论文的结果部分，可以这样组织表格（**推荐格式**）：

| Model | MSE | R² | Dir. Acc. | IC | RankIC | MAE | RMSE |
|-------|-----|----|----|----|----|-----|------|
| Full Model | 0.001234 | 0.8234 | 68.5% | 0.1234 | 0.1156 | 0.023456 | 0.035123 |
| w/o Quantum | 0.001456 | 0.7890 | 65.2% | 0.0987 | 0.0923 | 0.024567 | 0.038123 |
| w/o Graph | 0.001345 | 0.8012 | 66.8% | 0.1101 | 0.1034 | 0.023789 | 0.036234 |
| w/o MATCC | 0.001567 | 0.7654 | 63.4% | 0.0876 | 0.0812 | 0.025123 | 0.039567 |
| w/o Market Guidance | 0.001432 | 0.7987 | 66.1% | 0.1089 | 0.1012 | 0.024234 | 0.037890 |

**说明**：
- **前5列**（MSE, R², Dir. Acc., IC, RankIC）是核心指标，必须展示
- **后2列**（MAE, RMSE）是补充指标，提供更直观的误差度量
- IC 和 RankIC 是量化金融领域的标准指标，能显著提升论文的专业性

## 🔧 使用工具脚本查看

运行以下命令可以自动生成包含所有指标的对比表格：

```bash
cd paper/model
python plot_ablation_comparison.py
```

该脚本会：
- ✅ 读取所有 `losses_*.json` 文件
- ✅ 生成包含所有评估指标的汇总表格
- ✅ 自动计算各模块的贡献（相比 Full Model 的性能变化）
- ✅ 生成可视化对比图表

## 💡 注意事项

1. **指标计算时机**：所有指标都在**最佳模型**（验证集上 MSE 最低的模型）上计算
2. **数据范围**：指标在整个测试集上计算，确保公平对比
3. **方向准确率的重要性**：对于金融预测，方向准确率往往比 MSE 更重要，因为投资者更关心"涨还是跌"而不是"涨多少"
4. **R² 的解释**：R² = 0.8 表示模型解释了 80% 的方差，这在金融预测中已经是很不错的结果
5. **IC 和 RankIC 的重要性** ⭐：
   - 这两个指标是量化金融领域的**黄金标准**
   - IC > 0.05 或 RankIC > 0.05 已经是很好的结果
   - 在论文中展示这两个指标能显著提升专业性，让评审专家（特别是懂金融的）认可你的工作
   - RankIC 比 IC 更稳健，不受异常值影响，是基金公司最看重的指标
6. **指标解释**：
   - **IC**：衡量模型预测值与真实值的线性相关性（能否识别哪些股票会涨）
   - **RankIC**：衡量模型的排序能力（能否识别哪些股票会涨得更多）
   - 这两个指标直接回答了"你的模型能否用于量化投资"这个关键问题
