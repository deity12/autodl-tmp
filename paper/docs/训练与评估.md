# Training & Evaluation

Minimal guidance for Graph-RWKV training, ablation, and evaluation.

## Train Full Model

Entry: `3_train.py` (wraps `training/train_full.py`)

Defaults:
- Temporal encoder: RWKV
- Graph: semantic + statistical (hybrid)
- Rank loss: RankIC (optional RankNet pairwise)
- AMP / torch.compile / date-grouped batch supported

Run:

```bash
python 3_train.py
```

Common options:

```bash
# RankLoss type
python 3_train.py --rank_loss_type rankic --rankic_tau 1.0

# Walk-Forward
python 3_train.py --use_walk_forward   --wf_train_start 2018-01-01 --wf_train_end 2020-12-31   --wf_test_start 2021-01-01 --wf_test_end 2023-12-31 --wf_freq Q
```

Outputs:
- `outputs/checkpoints/best_model.pth`
- `outputs/logs/training_losses_full.json`
- `outputs/figures/training_curve_full.png`
- `outputs/results/experiment_full.json`
- `outputs/results/walk_forward_summary.json` (if enabled)

## Ablation

Entry: `3_train_ablation.py`

Types:
- `w/o_graph`
- `w/o_semantic`
- `w/o_statistical`
- `w/o_sentiment`
- `lstm_hybrid`
- `gru_hybrid`

Run:

```bash
python 3_train_ablation.py --ablation all
```

Outputs:
- `outputs/checkpoints/best_model_ablation_*.pth`
- `outputs/results/ablation_summary.json`

## Evaluation

Single model: `4_evaluate.py`

```bash
python 4_evaluate.py --checkpoint ./outputs/checkpoints/best_model.pth   --test_data ./data/processed/Final_Model_Data.csv
```

Batch evaluation: `evaluation/evaluate_all.py`

```bash
python -m evaluation.evaluate_all
```

Metrics:
- MSE / MAE / RMSE / R2
- IC / RankIC (daily cross-section)
- Top-K long-short backtest: annual return, Sharpe, max drawdown

Outputs:
- `outputs/results/evaluation_overall.csv`
- `outputs/results/evaluation_report.json`
- `outputs/figures/evaluation_comparison.png`
