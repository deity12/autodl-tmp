# Quick Start

Graph-RWKV end-to-end pipeline (5 scripts).

## Requirements

- Python 3.10+
- PyTorch 2.1+ (CUDA 11.8 common)
- Recommended hardware: GPU 24GB+ (48GB for LLM graph), CPU 8 cores+, RAM 32GB+

Install:

```bash
pip install -r requirements.txt
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

Optional (strict Qlib Alpha158): prepare Qlib data and install pyqlib.

## Data Layout

```text
paper/data/raw/FNSPID/
  - full_history/                 # per-ticker OHLCV CSV
  - nasdaq_exteral_data.csv        # news data
  - SP500_Index.csv                # index data (downloadable)
```

Download S&P 500 index (optional):

```bash
cd paper
python -m dataProcessed.download_market_index
```

## Run Pipeline

```bash
# 1) preprocess + align (Alpha158 lightweight enabled by default)
python 1_preprocess_data.py

# Use Qlib Alpha158 (if Qlib data is ready)
# python 1_preprocess_data.py --use_qlib_alpha158 --qlib_provider_uri /path/to/qlib_data --qlib_region US

# 2) build graph (LLM semantic + statistical + hybrid)
python 2_build_graph.py --llm

# 3) train full model (RankIC loss by default)
python 3_train.py

# 4) ablation runs
python 3_train_ablation.py --ablation all

# 5) evaluation + backtest
python 4_evaluate.py --checkpoint ./outputs/checkpoints/best_model.pth --test_data ./data/processed/Final_Model_Data.csv
python -m evaluation.evaluate_all
```

## Common Flags

- RankLoss: `--rank_loss_type rankic` (default) / `--rank_loss_type pairwise`
- Walk-Forward: `--use_walk_forward --wf_train_start 2018-01-01 --wf_train_end 2020-12-31 --wf_test_start 2021-01-01 --wf_test_end 2023-12-31 --wf_freq Q`
- LLM graph sampling: `--max_per_ticker` / `--max_total` / `--no-llm`

## Outputs

- `data/processed/Final_Model_Data.csv`
- `data/processed/Final_Model_Data_Alpha158.csv` + `data/processed/feature_columns.json`
- `data/processed/Graph_Adjacency.npy` + `data/processed/Graph_Tickers.json`
- `outputs/checkpoints/*.pth`
- `outputs/results/experiment_*.json` / `outputs/results/ablation_summary.json`
- `outputs/results/walk_forward_summary.json`

## One-shot

```bash
python run_all.py
```
